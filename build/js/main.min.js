document.addEventListener("DOMContentLoaded", (e) => {
  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
  // visible header
  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

  const invisible = document.querySelectorAll(".invisible *");
  const headerTimeout = setTimeout(() => {
    invisible.forEach((el) => {
      el.style.opacity = 1;
    });
  }, 1500);

  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
  // Initialize sliders
  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

  // ——————————————————————————————————————————————————
  // UsingAreasSlider
  // ——————————————————————————————————————————————————
  const usingAreas = new Swiper(".using-card__container", {
    speed: 400,
    spaceBetween: 10,
    slidesPerView: 1,
    loop: false,
    navigation: {
      nextEl: ".using-areas__pagination-next",
      prevEl: ".using-areas__pagination-prev",
    },
    breakpoints: {
      551: {
        slidesPerView: 2,
        spaceBetween: 40,
      },
      769: {
        slidesPerView: 3,
        spaceBetween: 11,
      },
      1026: {
        slidesPerView: 4,
      },
    },
  });

  // ——————————————————————————————————————————————————
  // DronicoSlider
  // ——————————————————————————————————————————————————
  const dronicoSlider = new Swiper(".dronico-slider__container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    spaceBetween: 100,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    grabCursor: true,
    navigation: {
      nextEl: ".dronico-slider__pagination-next",
      prevEl: ".dronico-slider__pagination-prev",
    },
  });
  const dronicoImgSlider = new Swiper(".dronico-slider__img-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    direction: "vertical",
    simulateTouch: false,
    mousewheelControl: false,
    freeMode: false,
    spaceBetween: 20,
  });
  const dronicoImgNumSlider = new Swiper(".dronico-slider__imgNum-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    mousewheelControl: false,
    freeMode: false,
    simulateTouch: false,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    breakpoints: {
      769: {
        slidesPerView: 1,
        spaceBetween: 0,
      },
      1441: {
        spaceBetween: 100,
      },
    },
  });

  dronicoSlider.controller.control = dronicoImgNumSlider;
  dronicoImgNumSlider.controller.control = dronicoImgSlider;

  // ——————————————————————————————————————————————————
  // MobileDronicoSlider
  // ——————————————————————————————————————————————————
  const dronicoMobileSlider = new Swiper(".dronico-slider__mobile-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    mousewheelControl: false,
    freeMode: false,
    simulateTouch: false,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    pagination: {
      el: ".dronico-slider__mobile-pagination",
      clickable: true,
    },
  });

  // ——————————————————————————————————————————————————
  // WorkSlider
  // ——————————————————————————————————————————————————
  const workSlider = new Swiper(".work__container", {
    speed: 400,
    slidesPerView: 6,
    spaceBetween: 23,
    navigation: {
      nextEl: ".work__navigation-next",
      prevEl: ".work__navigation-prev",
    },
  });

  const workContainer = document.createElement("div"),
    workCards = document.querySelectorAll(".work__slide"),
    workWrapper = document.querySelector(".work__wrapper");

  // check resize slider
  // function handleTabletChange(e) {
  //   if (e.matches) {
  //     workSlider.destroy(false, true);

  //     workContainer.className = "work__cards";
  //     workCards.forEach((card) => {
  //       workContainer.append(card);
  //     });
  // 		workWrapper.append(workContainer);

  //   } else {
  // 		workSlider.init();

  // 		workCards.forEach((card) => {
  // 			workWrapper.append(card);
  // 		});
  //   }
  // }
  // const mediaQuery = window.matchMedia("(max-width: 1251px)");
  // mediaQuery.addListener(handleTabletChange);
  // handleTabletChange(mediaQuery);

  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
  // MainCode
  // ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
  const dronsContainer = document.querySelector(".tech-dronico__img-container"),
    dronsBtns = document.querySelectorAll(".tech-dronico__btn"),
    dronTexts = document.querySelectorAll(".tech-dronico__text"),
    active = "active-btn";

  if (dronsContainer) {
    dronsContainer.addEventListener("click", (e) => {
      const target = e.target;
      if (target.classList.contains("tech-dronico__btn")) {
        dronsBtns.forEach((btn) => {
          btn.classList.remove(active);
        });
        dronTexts.forEach((text) => {
          text.classList.remove(active);
          if (text.dataset.text == target.dataset.text) {
            text.classList.add(active);
            target.classList.add(active);
          }
        });
      }
    });
  }

  // ——————————————————————————————————————————————————
  // LottieSvgOnMouseOver
  // ——————————————————————————————————————————————————
  const techTab = document.querySelector(".technologies__tabs");
  if (techTab) {
    techTab.onmouseover = techTab.onmouseout = (e) => {
      const target = e.target;
      if (target.classList.contains("technologies__tab")) {
        const techLottie = target.querySelector(".lottie-tech");
        if (techLottie) {
          if (e.type == "mouseover") {
            techLottie.play();
            techLottie.setLooping(true);
          } else {
            techLottie.setLooping(false);
          }
        }
      }
    };
  }

  // ——————————————————————————————————————————————————
  // FeedbackModal
  // ——————————————————————————————————————————————————
  function closeModal(modalSelector) {
    const modalWindow = document.querySelector(modalSelector);

    modalWindow.classList.remove("active");
  }

  function openModal(modalSelector, modalTimerId) {
    const modalWindow = document.querySelector(modalSelector);

    modalWindow.classList.add("active");
    if (modalTimerId) {
      clearInterval(modalTimerId);
    }
  }

  function modal(triggerSelector, modalSelector, modalTimerId) {
    const modalBtn = document.querySelectorAll(triggerSelector),
      modalWindow = document.querySelector(modalSelector);

    modalBtn.forEach((btn) => {
      btn.addEventListener("click", () =>
        openModal(modalSelector, modalTimerId)
      );
    });

    modalWindow.addEventListener("click", (e) => {
      if (e.target.getAttribute("data-close") == "") {
        closeModal(modalSelector);
      }
    });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Escape" && modalWindow.classList.contains("active")) {
        closeModal(modalSelector);
      }
    });

    function showModalByScroll() {
      if (
        window.pageYOffset + document.documentElement.clientHeight >=
        document.documentElement.scrollHeight
      ) {
        openModal(modalSelector, modalTimerId);
        window.removeEventListener("scroll", showModalByScroll);
      }
    }

    window.addEventListener("scroll", showModalByScroll);
  }

  const modalTimerId = setTimeout(
    () => openModal(".feedback", modalTimerId),
    600000
  );

  modal(".box", ".feedback", modalTimerId);

  // ——————————————————————————————————————————————————
  // Form
  // ——————————————————————————————————————————————————
  const form = document.querySelector(".feedback__form");
  form.addEventListener("submit", formSend);

  async function formSend(e) {
    e.preventDefault();

    let error = formValidate(form);

    const formData = new FormData(form);

    if (error === 0) {
      form.classList.add("._sending");
      let response = await fetch("php/sendmail.php", {
        method: "POST",
        body: formData,
      });
      if (response.ok) {
        let result = await response.json();
        alert(result.message);
        form.reset();
        form.classList.remove("_sending");
      } else {
        alert("Ошибка");
        form.classList.remove("_sending");
      }
    } else {
      alert("Заполни");
    }
  }

  function formValidate(form) {
    let error = 0;
    const formReq = document.querySelectorAll("._req");

    for (let i = 0; i < formReq.length; i++) {
      const input = formReq[i];
      formRemoveError(input);

      if (input.classList.contains("_name")) {
        if (!/^\w{4,20}$/gi.test(input.value)) {
          formAddError(input);
        }
      } else if (input.classList.contains("_phone")) {
        if (!/^\d{4,12}$/g.test(input.value)) {
          formAddError(input);
        }
      } else if (
        input.getAttribute("type") === "checkbox" &&
        input.checked === false
      ) {
        formAddError(input);
        error++;
      } else if (input.value === "") {
        formAddError(input);
        error++;
      }
    }
    return error;
  }

  function formAddError(input) {
    input.parentElement.classList.add("_error");
    input.classList.add("_error");
  }

  function formRemoveError(input) {
    input.parentElement.classList.remove("_error");
    input.classList.remove("_error");
  }

  // ——————————————————————————————————————————————————
  // TextScramble
  // ——————————————————————————————————————————————————

  class TextScramble {
    constructor(el) {
      this.el = el;
      this.chars = "0123456789><+-.%";
      this.update = this.update.bind(this);
    }
    setText(newText) {
      const oldText = this.el.innerText;
      const length = Math.max(oldText.length, newText.length);
      const promise = new Promise((resolve) => (this.resolve = resolve));
      this.queue = [];
      for (let i = 0; i < length; i++) {
        const from = oldText[i] || "";
        const to = newText[i] || "";
        const start = Math.floor(Math.random() * 40);
        const end = start + Math.floor(Math.random() * 40);
        this.queue.push({ from, to, start, end });
      }
      cancelAnimationFrame(this.frameRequest);
      this.frame = 0;
      this.update();
      return promise;
    }
    update() {
      let output = "";
      let complete = 0;
      for (let i = 0, n = this.queue.length; i < n; i++) {
        let { from, to, start, end, char } = this.queue[i];
        if (this.frame >= end) {
          complete++;
          output += to;
        } else if (this.frame >= start) {
          if (!char || Math.random() < 0.28) {
            char = this.randomChar();
            this.queue[i].char = char;
          }
          output += `<span class="dud">${char}</span>`;
        } else {
          output += from;
        }
      }
      this.el.innerHTML = output;
      if (complete === this.queue.length) {
        this.resolve();
      } else {
        this.frameRequest = requestAnimationFrame(this.update);
        this.frame++;
      }
    }
    randomChar() {
      return this.chars[Math.floor(Math.random() * this.chars.length)];
    }
  }
  const phrases = [
    "70.512323, 45.11974",
    "2.3513, -78.28398690",
    "74.32334, 24.34523",
    "-12.512323, 45.11974",
    "72.512344, 3.129043",
    "-70.512323, 20.11974",
    "83.123341, 42.75656",
  ];

  // const el = document.querySelectorAll(".scrumble-text");

  // const fx1 = new TextScramble(el[0]);
  // let counter1 = 0;
  // const next1 = () => {
  //   fx1.setText(phrases[counter1]).then(() => {
  //     setTimeout(next1, 800);
  //   });
  //   counter1 = (counter1 + 1) % phrases.length;
  // };
  // next1();

  // const fx2 = new TextScramble(el[1]);
  // let counter2 = 0;
  // const next2 = () => {
  //   fx2.setText(phrases[counter2]).then(() => {
  //     setTimeout(next2, 800);
  //   });
  //   counter2 = (counter2 + 1) % phrases.length;
  // };
  // next2();

  // Modal

  // ——————————————————————————————————————————————————
  // Parallax
  // ——————————————————————————————————————————————————

  const paralaxClass = ".rellax";

  const scenes = document.querySelectorAll(paralaxClass);
  scenes.forEach((scene) => {
    let parallax = new Parallax(scene, {
      relativeInput: true,
    });
  });

  const rellax = new Rellax(paralaxClass, {
    center: true,
	});

	// ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
  // openVideo
	// ——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
	const dronicoSliderContainer = document.querySelector('.dronico-slider__img-container');

});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIChlKSA9PiB7XHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgLy8gdmlzaWJsZSBoZWFkZXJcclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuXHJcbiAgY29uc3QgaW52aXNpYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5pbnZpc2libGUgKlwiKTtcclxuICBjb25zdCBoZWFkZXJUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBpbnZpc2libGUuZm9yRWFjaCgoZWwpID0+IHtcclxuICAgICAgZWwuc3R5bGUub3BhY2l0eSA9IDE7XHJcbiAgICB9KTtcclxuICB9LCAxNTAwKTtcclxuXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgLy8gSW5pdGlhbGl6ZSBzbGlkZXJzXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcblxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIC8vIFVzaW5nQXJlYXNTbGlkZXJcclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICBjb25zdCB1c2luZ0FyZWFzID0gbmV3IFN3aXBlcihcIi51c2luZy1jYXJkX19jb250YWluZXJcIiwge1xyXG4gICAgc3BlZWQ6IDQwMCxcclxuICAgIHNwYWNlQmV0d2VlbjogMTAsXHJcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgbG9vcDogZmFsc2UsXHJcbiAgICBuYXZpZ2F0aW9uOiB7XHJcbiAgICAgIG5leHRFbDogXCIudXNpbmctYXJlYXNfX3BhZ2luYXRpb24tbmV4dFwiLFxyXG4gICAgICBwcmV2RWw6IFwiLnVzaW5nLWFyZWFzX19wYWdpbmF0aW9uLXByZXZcIixcclxuICAgIH0sXHJcbiAgICBicmVha3BvaW50czoge1xyXG4gICAgICA1NTE6IHtcclxuICAgICAgICBzbGlkZXNQZXJWaWV3OiAyLFxyXG4gICAgICAgIHNwYWNlQmV0d2VlbjogNDAsXHJcbiAgICAgIH0sXHJcbiAgICAgIDc2OToge1xyXG4gICAgICAgIHNsaWRlc1BlclZpZXc6IDMsXHJcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiAxMSxcclxuICAgICAgfSxcclxuICAgICAgMTAyNjoge1xyXG4gICAgICAgIHNsaWRlc1BlclZpZXc6IDQsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICAvLyBEcm9uaWNvU2xpZGVyXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgY29uc3QgZHJvbmljb1NsaWRlciA9IG5ldyBTd2lwZXIoXCIuZHJvbmljby1zbGlkZXJfX2NvbnRhaW5lclwiLCB7XHJcbiAgICBzcGVlZDogNTAwLFxyXG4gICAgc2xpZGVzUGVyVmlldzogMSxcclxuICAgIGxvb3A6IHRydWUsXHJcbiAgICBzcGFjZUJldHdlZW46IDEwMCxcclxuICAgIGVmZmVjdDogXCJmYWRlXCIsXHJcbiAgICBmYWRlRWZmZWN0OiB7XHJcbiAgICAgIGNyb3NzRmFkZTogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICBncmFiQ3Vyc29yOiB0cnVlLFxyXG4gICAgbmF2aWdhdGlvbjoge1xyXG4gICAgICBuZXh0RWw6IFwiLmRyb25pY28tc2xpZGVyX19wYWdpbmF0aW9uLW5leHRcIixcclxuICAgICAgcHJldkVsOiBcIi5kcm9uaWNvLXNsaWRlcl9fcGFnaW5hdGlvbi1wcmV2XCIsXHJcbiAgICB9LFxyXG4gIH0pO1xyXG4gIGNvbnN0IGRyb25pY29JbWdTbGlkZXIgPSBuZXcgU3dpcGVyKFwiLmRyb25pY28tc2xpZGVyX19pbWctY29udGFpbmVyXCIsIHtcclxuICAgIHNwZWVkOiA1MDAsXHJcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgbG9vcDogdHJ1ZSxcclxuICAgIGRpcmVjdGlvbjogXCJ2ZXJ0aWNhbFwiLFxyXG4gICAgc2ltdWxhdGVUb3VjaDogZmFsc2UsXHJcbiAgICBtb3VzZXdoZWVsQ29udHJvbDogZmFsc2UsXHJcbiAgICBmcmVlTW9kZTogZmFsc2UsXHJcbiAgICBzcGFjZUJldHdlZW46IDIwLFxyXG4gIH0pO1xyXG4gIGNvbnN0IGRyb25pY29JbWdOdW1TbGlkZXIgPSBuZXcgU3dpcGVyKFwiLmRyb25pY28tc2xpZGVyX19pbWdOdW0tY29udGFpbmVyXCIsIHtcclxuICAgIHNwZWVkOiA1MDAsXHJcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgbG9vcDogdHJ1ZSxcclxuICAgIG1vdXNld2hlZWxDb250cm9sOiBmYWxzZSxcclxuICAgIGZyZWVNb2RlOiBmYWxzZSxcclxuICAgIHNpbXVsYXRlVG91Y2g6IGZhbHNlLFxyXG4gICAgZWZmZWN0OiBcImZhZGVcIixcclxuICAgIGZhZGVFZmZlY3Q6IHtcclxuICAgICAgY3Jvc3NGYWRlOiB0cnVlLFxyXG4gICAgfSxcclxuICAgIGJyZWFrcG9pbnRzOiB7XHJcbiAgICAgIDc2OToge1xyXG4gICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXHJcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxyXG4gICAgICB9LFxyXG4gICAgICAxNDQxOiB7XHJcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiAxMDAsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuICBkcm9uaWNvU2xpZGVyLmNvbnRyb2xsZXIuY29udHJvbCA9IGRyb25pY29JbWdOdW1TbGlkZXI7XHJcbiAgZHJvbmljb0ltZ051bVNsaWRlci5jb250cm9sbGVyLmNvbnRyb2wgPSBkcm9uaWNvSW1nU2xpZGVyO1xyXG5cclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICAvLyBNb2JpbGVEcm9uaWNvU2xpZGVyXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgY29uc3QgZHJvbmljb01vYmlsZVNsaWRlciA9IG5ldyBTd2lwZXIoXCIuZHJvbmljby1zbGlkZXJfX21vYmlsZS1jb250YWluZXJcIiwge1xyXG4gICAgc3BlZWQ6IDUwMCxcclxuICAgIHNsaWRlc1BlclZpZXc6IDEsXHJcbiAgICBsb29wOiB0cnVlLFxyXG4gICAgbW91c2V3aGVlbENvbnRyb2w6IGZhbHNlLFxyXG4gICAgZnJlZU1vZGU6IGZhbHNlLFxyXG4gICAgc2ltdWxhdGVUb3VjaDogZmFsc2UsXHJcbiAgICBlZmZlY3Q6IFwiZmFkZVwiLFxyXG4gICAgZmFkZUVmZmVjdDoge1xyXG4gICAgICBjcm9zc0ZhZGU6IHRydWUsXHJcbiAgICB9LFxyXG4gICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICBlbDogXCIuZHJvbmljby1zbGlkZXJfX21vYmlsZS1wYWdpbmF0aW9uXCIsXHJcbiAgICAgIGNsaWNrYWJsZTogdHJ1ZSxcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIC8vIFdvcmtTbGlkZXJcclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICBjb25zdCB3b3JrU2xpZGVyID0gbmV3IFN3aXBlcihcIi53b3JrX19jb250YWluZXJcIiwge1xyXG4gICAgc3BlZWQ6IDQwMCxcclxuICAgIHNsaWRlc1BlclZpZXc6IDYsXHJcbiAgICBzcGFjZUJldHdlZW46IDIzLFxyXG4gICAgbmF2aWdhdGlvbjoge1xyXG4gICAgICBuZXh0RWw6IFwiLndvcmtfX25hdmlnYXRpb24tbmV4dFwiLFxyXG4gICAgICBwcmV2RWw6IFwiLndvcmtfX25hdmlnYXRpb24tcHJldlwiLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgY29uc3Qgd29ya0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksXHJcbiAgICB3b3JrQ2FyZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLndvcmtfX3NsaWRlXCIpLFxyXG4gICAgd29ya1dyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndvcmtfX3dyYXBwZXJcIik7XHJcblxyXG4gIC8vIGNoZWNrIHJlc2l6ZSBzbGlkZXJcclxuICAvLyBmdW5jdGlvbiBoYW5kbGVUYWJsZXRDaGFuZ2UoZSkge1xyXG4gIC8vICAgaWYgKGUubWF0Y2hlcykge1xyXG4gIC8vICAgICB3b3JrU2xpZGVyLmRlc3Ryb3koZmFsc2UsIHRydWUpO1xyXG5cclxuICAvLyAgICAgd29ya0NvbnRhaW5lci5jbGFzc05hbWUgPSBcIndvcmtfX2NhcmRzXCI7XHJcbiAgLy8gICAgIHdvcmtDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgLy8gICAgICAgd29ya0NvbnRhaW5lci5hcHBlbmQoY2FyZCk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vIFx0XHR3b3JrV3JhcHBlci5hcHBlbmQod29ya0NvbnRhaW5lcik7XHJcblxyXG4gIC8vICAgfSBlbHNlIHtcclxuICAvLyBcdFx0d29ya1NsaWRlci5pbml0KCk7XHJcblxyXG4gIC8vIFx0XHR3b3JrQ2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gIC8vIFx0XHRcdHdvcmtXcmFwcGVyLmFwcGVuZChjYXJkKTtcclxuICAvLyBcdFx0fSk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG4gIC8vIGNvbnN0IG1lZGlhUXVlcnkgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDEyNTFweClcIik7XHJcbiAgLy8gbWVkaWFRdWVyeS5hZGRMaXN0ZW5lcihoYW5kbGVUYWJsZXRDaGFuZ2UpO1xyXG4gIC8vIGhhbmRsZVRhYmxldENoYW5nZShtZWRpYVF1ZXJ5KTtcclxuXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgLy8gTWFpbkNvZGVcclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICBjb25zdCBkcm9uc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVjaC1kcm9uaWNvX19pbWctY29udGFpbmVyXCIpLFxyXG4gICAgZHJvbnNCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50ZWNoLWRyb25pY29fX2J0blwiKSxcclxuICAgIGRyb25UZXh0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGVjaC1kcm9uaWNvX190ZXh0XCIpLFxyXG4gICAgYWN0aXZlID0gXCJhY3RpdmUtYnRuXCI7XHJcblxyXG4gIGlmIChkcm9uc0NvbnRhaW5lcikge1xyXG4gICAgZHJvbnNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRlY2gtZHJvbmljb19fYnRuXCIpKSB7XHJcbiAgICAgICAgZHJvbnNCdG5zLmZvckVhY2goKGJ0bikgPT4ge1xyXG4gICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoYWN0aXZlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBkcm9uVGV4dHMuZm9yRWFjaCgodGV4dCkgPT4ge1xyXG4gICAgICAgICAgdGV4dC5jbGFzc0xpc3QucmVtb3ZlKGFjdGl2ZSk7XHJcbiAgICAgICAgICBpZiAodGV4dC5kYXRhc2V0LnRleHQgPT0gdGFyZ2V0LmRhdGFzZXQudGV4dCkge1xyXG4gICAgICAgICAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoYWN0aXZlKTtcclxuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoYWN0aXZlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICAvLyBMb3R0aWVTdmdPbk1vdXNlT3ZlclxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIGNvbnN0IHRlY2hUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRlY2hub2xvZ2llc19fdGFic1wiKTtcclxuICBpZiAodGVjaFRhYikge1xyXG4gICAgdGVjaFRhYi5vbm1vdXNlb3ZlciA9IHRlY2hUYWIub25tb3VzZW91dCA9IChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRlY2hub2xvZ2llc19fdGFiXCIpKSB7XHJcbiAgICAgICAgY29uc3QgdGVjaExvdHRpZSA9IHRhcmdldC5xdWVyeVNlbGVjdG9yKFwiLmxvdHRpZS10ZWNoXCIpO1xyXG4gICAgICAgIGlmICh0ZWNoTG90dGllKSB7XHJcbiAgICAgICAgICBpZiAoZS50eXBlID09IFwibW91c2VvdmVyXCIpIHtcclxuICAgICAgICAgICAgdGVjaExvdHRpZS5wbGF5KCk7XHJcbiAgICAgICAgICAgIHRlY2hMb3R0aWUuc2V0TG9vcGluZyh0cnVlKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRlY2hMb3R0aWUuc2V0TG9vcGluZyhmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgLy8gRmVlZGJhY2tNb2RhbFxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIGZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWxTZWxlY3Rvcikge1xyXG4gICAgY29uc3QgbW9kYWxXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG1vZGFsU2VsZWN0b3IpO1xyXG5cclxuICAgIG1vZGFsV2luZG93LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBvcGVuTW9kYWwobW9kYWxTZWxlY3RvciwgbW9kYWxUaW1lcklkKSB7XHJcbiAgICBjb25zdCBtb2RhbFdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XHJcblxyXG4gICAgbW9kYWxXaW5kb3cuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuICAgIGlmIChtb2RhbFRpbWVySWQpIHtcclxuICAgICAgY2xlYXJJbnRlcnZhbChtb2RhbFRpbWVySWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gbW9kYWwodHJpZ2dlclNlbGVjdG9yLCBtb2RhbFNlbGVjdG9yLCBtb2RhbFRpbWVySWQpIHtcclxuICAgIGNvbnN0IG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0cmlnZ2VyU2VsZWN0b3IpLFxyXG4gICAgICBtb2RhbFdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XHJcblxyXG4gICAgbW9kYWxCdG4uZm9yRWFjaCgoYnRuKSA9PiB7XHJcbiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICBvcGVuTW9kYWwobW9kYWxTZWxlY3RvciwgbW9kYWxUaW1lcklkKVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbW9kYWxXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNsb3NlXCIpID09IFwiXCIpIHtcclxuICAgICAgICBjbG9zZU1vZGFsKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgaWYgKGUuY29kZSA9PT0gXCJFc2NhcGVcIiAmJiBtb2RhbFdpbmRvdy5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmVcIikpIHtcclxuICAgICAgICBjbG9zZU1vZGFsKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBzaG93TW9kYWxCeVNjcm9sbCgpIHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIHdpbmRvdy5wYWdlWU9mZnNldCArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgPj1cclxuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0XHJcbiAgICAgICkge1xyXG4gICAgICAgIG9wZW5Nb2RhbChtb2RhbFNlbGVjdG9yLCBtb2RhbFRpbWVySWQpO1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHNob3dNb2RhbEJ5U2Nyb2xsKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHNob3dNb2RhbEJ5U2Nyb2xsKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IG1vZGFsVGltZXJJZCA9IHNldFRpbWVvdXQoXHJcbiAgICAoKSA9PiBvcGVuTW9kYWwoXCIuZmVlZGJhY2tcIiwgbW9kYWxUaW1lcklkKSxcclxuICAgIDYwMDAwMFxyXG4gICk7XHJcblxyXG4gIG1vZGFsKFwiLmJveFwiLCBcIi5mZWVkYmFja1wiLCBtb2RhbFRpbWVySWQpO1xyXG5cclxuICAvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICAvLyBGb3JtXHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZmVlZGJhY2tfX2Zvcm1cIik7XHJcbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZvcm1TZW5kKTtcclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZm9ybVNlbmQoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGxldCBlcnJvciA9IGZvcm1WYWxpZGF0ZShmb3JtKTtcclxuXHJcbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTtcclxuXHJcbiAgICBpZiAoZXJyb3IgPT09IDApIHtcclxuICAgICAgZm9ybS5jbGFzc0xpc3QuYWRkKFwiLl9zZW5kaW5nXCIpO1xyXG4gICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcInBocC9zZW5kbWFpbC5waHBcIiwge1xyXG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgYm9keTogZm9ybURhdGEsXHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAocmVzcG9uc2Uub2spIHtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgIGFsZXJ0KHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICBmb3JtLnJlc2V0KCk7XHJcbiAgICAgICAgZm9ybS5jbGFzc0xpc3QucmVtb3ZlKFwiX3NlbmRpbmdcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYWxlcnQoXCLQntGI0LjQsdC60LBcIik7XHJcbiAgICAgICAgZm9ybS5jbGFzc0xpc3QucmVtb3ZlKFwiX3NlbmRpbmdcIik7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFsZXJ0KFwi0JfQsNC/0L7Qu9C90LhcIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBmb3JtVmFsaWRhdGUoZm9ybSkge1xyXG4gICAgbGV0IGVycm9yID0gMDtcclxuICAgIGNvbnN0IGZvcm1SZXEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLl9yZXFcIik7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb3JtUmVxLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGlucHV0ID0gZm9ybVJlcVtpXTtcclxuICAgICAgZm9ybVJlbW92ZUVycm9yKGlucHV0KTtcclxuXHJcbiAgICAgIGlmIChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoXCJfbmFtZVwiKSkge1xyXG4gICAgICAgIGlmICghL15cXHd7NCwyMH0kL2dpLnRlc3QoaW5wdXQudmFsdWUpKSB7XHJcbiAgICAgICAgICBmb3JtQWRkRXJyb3IoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoXCJfcGhvbmVcIikpIHtcclxuICAgICAgICBpZiAoIS9eXFxkezQsMTJ9JC9nLnRlc3QoaW5wdXQudmFsdWUpKSB7XHJcbiAgICAgICAgICBmb3JtQWRkRXJyb3IoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICBpbnB1dC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpID09PSBcImNoZWNrYm94XCIgJiZcclxuICAgICAgICBpbnB1dC5jaGVja2VkID09PSBmYWxzZVxyXG4gICAgICApIHtcclxuICAgICAgICBmb3JtQWRkRXJyb3IoaW5wdXQpO1xyXG4gICAgICAgIGVycm9yKys7XHJcbiAgICAgIH0gZWxzZSBpZiAoaW5wdXQudmFsdWUgPT09IFwiXCIpIHtcclxuICAgICAgICBmb3JtQWRkRXJyb3IoaW5wdXQpO1xyXG4gICAgICAgIGVycm9yKys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBlcnJvcjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGZvcm1BZGRFcnJvcihpbnB1dCkge1xyXG4gICAgaW5wdXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiX2Vycm9yXCIpO1xyXG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcIl9lcnJvclwiKTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGZvcm1SZW1vdmVFcnJvcihpbnB1dCkge1xyXG4gICAgaW5wdXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiX2Vycm9yXCIpO1xyXG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShcIl9lcnJvclwiKTtcclxuICB9XHJcblxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIC8vIFRleHRTY3JhbWJsZVxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG5cclxuICBjbGFzcyBUZXh0U2NyYW1ibGUge1xyXG4gICAgY29uc3RydWN0b3IoZWwpIHtcclxuICAgICAgdGhpcy5lbCA9IGVsO1xyXG4gICAgICB0aGlzLmNoYXJzID0gXCIwMTIzNDU2Nzg5PjwrLS4lXCI7XHJcbiAgICAgIHRoaXMudXBkYXRlID0gdGhpcy51cGRhdGUuYmluZCh0aGlzKTtcclxuICAgIH1cclxuICAgIHNldFRleHQobmV3VGV4dCkge1xyXG4gICAgICBjb25zdCBvbGRUZXh0ID0gdGhpcy5lbC5pbm5lclRleHQ7XHJcbiAgICAgIGNvbnN0IGxlbmd0aCA9IE1hdGgubWF4KG9sZFRleHQubGVuZ3RoLCBuZXdUZXh0Lmxlbmd0aCk7XHJcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gKHRoaXMucmVzb2x2ZSA9IHJlc29sdmUpKTtcclxuICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgZnJvbSA9IG9sZFRleHRbaV0gfHwgXCJcIjtcclxuICAgICAgICBjb25zdCB0byA9IG5ld1RleHRbaV0gfHwgXCJcIjtcclxuICAgICAgICBjb25zdCBzdGFydCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQwKTtcclxuICAgICAgICBjb25zdCBlbmQgPSBzdGFydCArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQwKTtcclxuICAgICAgICB0aGlzLnF1ZXVlLnB1c2goeyBmcm9tLCB0bywgc3RhcnQsIGVuZCB9KTtcclxuICAgICAgfVxyXG4gICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmZyYW1lUmVxdWVzdCk7XHJcbiAgICAgIHRoaXMuZnJhbWUgPSAwO1xyXG4gICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgIH1cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgbGV0IG91dHB1dCA9IFwiXCI7XHJcbiAgICAgIGxldCBjb21wbGV0ZSA9IDA7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gdGhpcy5xdWV1ZS5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICBsZXQgeyBmcm9tLCB0bywgc3RhcnQsIGVuZCwgY2hhciB9ID0gdGhpcy5xdWV1ZVtpXTtcclxuICAgICAgICBpZiAodGhpcy5mcmFtZSA+PSBlbmQpIHtcclxuICAgICAgICAgIGNvbXBsZXRlKys7XHJcbiAgICAgICAgICBvdXRwdXQgKz0gdG87XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZyYW1lID49IHN0YXJ0KSB7XHJcbiAgICAgICAgICBpZiAoIWNoYXIgfHwgTWF0aC5yYW5kb20oKSA8IDAuMjgpIHtcclxuICAgICAgICAgICAgY2hhciA9IHRoaXMucmFuZG9tQ2hhcigpO1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXVlW2ldLmNoYXIgPSBjaGFyO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgb3V0cHV0ICs9IGA8c3BhbiBjbGFzcz1cImR1ZFwiPiR7Y2hhcn08L3NwYW4+YDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgb3V0cHV0ICs9IGZyb207XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gb3V0cHV0O1xyXG4gICAgICBpZiAoY29tcGxldGUgPT09IHRoaXMucXVldWUubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5mcmFtZVJlcXVlc3QgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy51cGRhdGUpO1xyXG4gICAgICAgIHRoaXMuZnJhbWUrKztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmFuZG9tQ2hhcigpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY2hhcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5jaGFycy5sZW5ndGgpXTtcclxuICAgIH1cclxuICB9XHJcbiAgY29uc3QgcGhyYXNlcyA9IFtcclxuICAgIFwiNzAuNTEyMzIzLCA0NS4xMTk3NFwiLFxyXG4gICAgXCIyLjM1MTMsIC03OC4yODM5ODY5MFwiLFxyXG4gICAgXCI3NC4zMjMzNCwgMjQuMzQ1MjNcIixcclxuICAgIFwiLTEyLjUxMjMyMywgNDUuMTE5NzRcIixcclxuICAgIFwiNzIuNTEyMzQ0LCAzLjEyOTA0M1wiLFxyXG4gICAgXCItNzAuNTEyMzIzLCAyMC4xMTk3NFwiLFxyXG4gICAgXCI4My4xMjMzNDEsIDQyLjc1NjU2XCIsXHJcbiAgXTtcclxuXHJcbiAgLy8gY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNjcnVtYmxlLXRleHRcIik7XHJcblxyXG4gIC8vIGNvbnN0IGZ4MSA9IG5ldyBUZXh0U2NyYW1ibGUoZWxbMF0pO1xyXG4gIC8vIGxldCBjb3VudGVyMSA9IDA7XHJcbiAgLy8gY29uc3QgbmV4dDEgPSAoKSA9PiB7XHJcbiAgLy8gICBmeDEuc2V0VGV4dChwaHJhc2VzW2NvdW50ZXIxXSkudGhlbigoKSA9PiB7XHJcbiAgLy8gICAgIHNldFRpbWVvdXQobmV4dDEsIDgwMCk7XHJcbiAgLy8gICB9KTtcclxuICAvLyAgIGNvdW50ZXIxID0gKGNvdW50ZXIxICsgMSkgJSBwaHJhc2VzLmxlbmd0aDtcclxuICAvLyB9O1xyXG4gIC8vIG5leHQxKCk7XHJcblxyXG4gIC8vIGNvbnN0IGZ4MiA9IG5ldyBUZXh0U2NyYW1ibGUoZWxbMV0pO1xyXG4gIC8vIGxldCBjb3VudGVyMiA9IDA7XHJcbiAgLy8gY29uc3QgbmV4dDIgPSAoKSA9PiB7XHJcbiAgLy8gICBmeDIuc2V0VGV4dChwaHJhc2VzW2NvdW50ZXIyXSkudGhlbigoKSA9PiB7XHJcbiAgLy8gICAgIHNldFRpbWVvdXQobmV4dDIsIDgwMCk7XHJcbiAgLy8gICB9KTtcclxuICAvLyAgIGNvdW50ZXIyID0gKGNvdW50ZXIyICsgMSkgJSBwaHJhc2VzLmxlbmd0aDtcclxuICAvLyB9O1xyXG4gIC8vIG5leHQyKCk7XHJcblxyXG4gIC8vIE1vZGFsXHJcblxyXG4gIC8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxyXG4gIC8vIFBhcmFsbGF4XHJcbiAgLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcblxyXG4gIGNvbnN0IHBhcmFsYXhDbGFzcyA9IFwiLnJlbGxheFwiO1xyXG5cclxuICBjb25zdCBzY2VuZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHBhcmFsYXhDbGFzcyk7XHJcbiAgc2NlbmVzLmZvckVhY2goKHNjZW5lKSA9PiB7XHJcbiAgICBsZXQgcGFyYWxsYXggPSBuZXcgUGFyYWxsYXgoc2NlbmUsIHtcclxuICAgICAgcmVsYXRpdmVJbnB1dDogdHJ1ZSxcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCByZWxsYXggPSBuZXcgUmVsbGF4KHBhcmFsYXhDbGFzcywge1xyXG4gICAgY2VudGVyOiB0cnVlLFxyXG5cdH0pO1xyXG5cclxuXHQvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuICAvLyBvcGVuVmlkZW9cclxuXHQvLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuXHRjb25zdCBkcm9uaWNvU2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRyb25pY28tc2xpZGVyX19pbWctY29udGFpbmVyJyk7XHJcblxyXG59KTtcclxuIl0sImZpbGUiOiJtYWluLm1pbi5qcyJ9
