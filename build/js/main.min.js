document.addEventListener("DOMContentLoaded", (e) => {
  // initialize using-areas-slider
  const usingAreas = new Swiper(".using-card__container", {
    speed: 400,
    spaceBetween: 10,
    slidesPerView: 1,
    loop: true,
    navigation: {
      nextEl: ".using-areas__pagination-next",
      prevEl: ".using-areas__pagination-prev",
    },
    breakpoints: {
      551: {
        slidesPerView: 2,
        spaceBetween: 40,
      },
      769: {
        slidesPerView: 3,
        spaceBetween: 11,
      },
      1026: {
        slidesPerView: 4,
      },
    },
  });

  // Initialize dronico slider
  const dronicoSlider = new Swiper(".dronico-slider__container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    spaceBetween: 100,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    grabCursor: true,
    navigation: {
      nextEl: ".dronico-slider__pagination-next",
      prevEl: ".dronico-slider__pagination-prev",
    },
  });
  const dronicoImgSlider = new Swiper(".dronico-slider__img-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    direction: "vertical",
    simulateTouch: false,
    mousewheelControl: false,
    freeMode: false,
  });
  const dronicoImgNumSlider = new Swiper(".dronico-slider__imgNum-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    mousewheelControl: false,
    freeMode: false,
    simulateTouch: false,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    breakpoints: {
      769: {
        slidesPerView: 1,
        spaceBetween: 0,
      },
      1441: {
        spaceBetween: 100,
      },
    },
  });

  dronicoSlider.controller.control = dronicoImgNumSlider;
  dronicoImgNumSlider.controller.control = dronicoImgSlider;

  // Initialize mobile dronico slider
  const dronicoMobileSlider = new Swiper(".dronico-slider__mobile-container", {
    speed: 500,
    slidesPerView: 1,
    loop: true,
    mousewheelControl: false,
    freeMode: false,
    simulateTouch: false,
    effect: "fade",
    fadeEffect: {
      crossFade: true,
    },
    pagination: {
      el: ".dronico-slider__mobile-pagination",
      clickable: true,
    },
  });

  // Initialize work slider
  const workSlider = new Swiper(".work__container", {
    speed: 400,
    slidesPerView: 6,
    spaceBetween: 23,
    navigation: {
      nextEl: ".work__navigation-next",
      prevEl: ".work__navigation-prev",
    },
  });

  const workContainer = document.createElement("div"),
    workCards = document.querySelectorAll(".work__slide"),
    workWrapper = document.querySelector(".work__wrapper");

  // check resize slider
  // function handleTabletChange(e) {
  //   if (e.matches) {
  //     workSlider.destroy(false, true);

  //     workContainer.className = "work__cards";
  //     workCards.forEach((card) => {
  //       workContainer.append(card);
  //     });
  // 		workWrapper.append(workContainer);

  //   } else {
  // 		workSlider.init();

  // 		workCards.forEach((card) => {
  // 			workWrapper.append(card);
  // 		});
  //   }
  // }
  // const mediaQuery = window.matchMedia("(max-width: 1251px)");
  // mediaQuery.addListener(handleTabletChange);
  // handleTabletChange(mediaQuery);

  // Main code
  const dronsContainer = document.querySelector(".tech-dronico__img-container"),
    dronsBtns = document.querySelectorAll(".tech-dronico__btn"),
    dronTexts = document.querySelectorAll(".tech-dronico__text"),
    active = "active-btn";

  if (dronsContainer) {
    dronsContainer.addEventListener("click", (e) => {
      const target = e.target;
      if (target.classList.contains("tech-dronico__btn")) {
        dronsBtns.forEach((btn) => {
          btn.classList.remove(active);
        });
        dronTexts.forEach((text) => {
          text.classList.remove(active);
          if (text.dataset.text == target.dataset.text) {
            text.classList.add(active);
            target.classList.add(active);
          }
        });
      }
    });
  }

  //Lottie svg handlers
  const techTab = document.querySelector(".technologies__tabs");
  if (techTab) {
    techTab.onmouseover = techTab.onmouseout = (e) => {
      const target = e.target;
      if (target.classList.contains("technologies__tab")) {
        const techLottie = target.querySelector(".lottie-tech");
        if (techLottie) {
          if (e.type == "mouseover") {
            techLottie.play();
            techLottie.setLooping(true);
          } else {
            techLottie.setLooping(false);
          }
        }
      }
    };
  }
});

// ——————————————————————————————————————————————————
// TextScramble
// ——————————————————————————————————————————————————

class TextScramble {
  constructor(el) {
    this.el = el;
    this.chars = "0123456789><+-.%";
    this.update = this.update.bind(this);
  }
  setText(newText) {
    const oldText = this.el.innerText;
    const length = Math.max(oldText.length, newText.length);
    const promise = new Promise((resolve) => (this.resolve = resolve));
    this.queue = [];
    for (let i = 0; i < length; i++) {
      const from = oldText[i] || "";
      const to = newText[i] || "";
      const start = Math.floor(Math.random() * 40);
      const end = start + Math.floor(Math.random() * 40);
      this.queue.push({ from, to, start, end });
    }
    cancelAnimationFrame(this.frameRequest);
    this.frame = 0;
    this.update();
    return promise;
  }
  update() {
    let output = "";
    let complete = 0;
    for (let i = 0, n = this.queue.length; i < n; i++) {
      let { from, to, start, end, char } = this.queue[i];
      if (this.frame >= end) {
        complete++;
        output += to;
      } else if (this.frame >= start) {
        if (!char || Math.random() < 0.28) {
          char = this.randomChar();
          this.queue[i].char = char;
        }
        output += `<span class="dud">${char}</span>`;
      } else {
        output += from;
      }
    }
    this.el.innerHTML = output;
    if (complete === this.queue.length) {
      this.resolve();
    } else {
      this.frameRequest = requestAnimationFrame(this.update);
      this.frame++;
    }
  }
  randomChar() {
    return this.chars[Math.floor(Math.random() * this.chars.length)];
  }
}
const phrases = [
  "70.512323, 45.11974",
  "2.3513, -78.28398690",
  "74.32334, 24.34523",
  "-12.512323, 45.11974",
  "72.512344, 3.129043",
  "-70.512323, 20.11974",
  "83.123341, 42.75656",
];

// const el = document.querySelectorAll(".scrumble-text");

// const fx1 = new TextScramble(el[0]);
// let counter1 = 0;
// const next1 = () => {
//   fx1.setText(phrases[counter1]).then(() => {
//     setTimeout(next1, 800);
//   });
//   counter1 = (counter1 + 1) % phrases.length;
// };
// next1();

// const fx2 = new TextScramble(el[1]);
// let counter2 = 0;
// const next2 = () => {
//   fx2.setText(phrases[counter2]).then(() => {
//     setTimeout(next2, 800);
//   });
//   counter2 = (counter2 + 1) % phrases.length;
// };
// next2();

// Modal

function closeModal(modalSelector) {
  const modalWindow = document.querySelector(modalSelector);

  modalWindow.classList.remove("active");
}

function openModal(modalSelector, modalTimerId) {
  const modalWindow = document.querySelector(modalSelector);

  modalWindow.classList.add("active");
  if (modalTimerId) {
    clearInterval(modalTimerId);
  }
}

function modal(triggerSelector, modalSelector, modalTimerId) {
  const modalBtn = document.querySelectorAll(triggerSelector),
    modalWindow = document.querySelector(modalSelector);

  modalBtn.forEach((btn) => {
    btn.addEventListener("click", () => openModal(modalSelector, modalTimerId));
  });

  modalWindow.addEventListener("click", (e) => {
    if (e.target.getAttribute("data-close") == "") {
      closeModal(modalSelector);
    }
  });

  window.addEventListener("keydown", (e) => {
    if (e.code === "Escape" && modalWindow.classList.contains("active")) {
      closeModal(modalSelector);
    }
  });

  function showModalByScroll() {
    if (
      window.pageYOffset + document.documentElement.clientHeight >=
      document.documentElement.scrollHeight
    ) {
      openModal(modalSelector, modalTimerId);
      window.removeEventListener("scroll", showModalByScroll);
    }
  }

  window.addEventListener("scroll", showModalByScroll);
}

const modalTimerId = setTimeout(
  () => openModal(".feedback", modalTimerId),
  600000
);

modal(".box", ".feedback", modalTimerId);

//FORM
const form = document.querySelector(".feedback__form");
form.addEventListener("submit", formSend);

async function formSend(e) {
  e.preventDefault();

  let error = formValidate(form);

  const formData = new FormData(form);

  if (error === 0) {
    form.classList.add("._sending");
    let response = await fetch("php/sendmail.php", {
      method: "POST",
      body: formData,
    });
    if (response.ok) {
      let result = await response.json();
      alert(result.message);
      form.reset();
      form.classList.remove("_sending");
    } else {
      alert("Ошибка");
      form.classList.remove("_sending");
    }
  } else {
    alert("Заполни");
  }
}

function formValidate(form) {
  let error = 0;
  const formReq = document.querySelectorAll("._req");

  for (let i = 0; i < formReq.length; i++) {
    const input = formReq[i];
    formRemoveError(input);

    if (input.classList.contains("_name")) {
      if (!/^\w{4,20}$/gi.test(input.value)) {
        formAddError(input);
      }
    } else if (input.classList.contains("_phone")) {
      if (!/^\d{4,12}$/g.test(input.value)) {
        formAddError(input);
      }
    } else if (
      input.getAttribute("type") === "checkbox" &&
      input.checked === false
    ) {
      formAddError(input);
      error++;
    } else if (input.value === "") {
      formAddError(input);
      error++;
    }
  }
  return error;
}

function formAddError(input) {
  input.parentElement.classList.add("_error");
  input.classList.add("_error");
}

function formRemoveError(input) {
  input.parentElement.classList.remove("_error");
  input.classList.remove("_error");
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIChlKSA9PiB7XHJcbiAgLy8gaW5pdGlhbGl6ZSB1c2luZy1hcmVhcy1zbGlkZXJcclxuICBjb25zdCB1c2luZ0FyZWFzID0gbmV3IFN3aXBlcihcIi51c2luZy1jYXJkX19jb250YWluZXJcIiwge1xyXG4gICAgc3BlZWQ6IDQwMCxcclxuICAgIHNwYWNlQmV0d2VlbjogMTAsXHJcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgbG9vcDogdHJ1ZSxcclxuICAgIG5hdmlnYXRpb246IHtcclxuICAgICAgbmV4dEVsOiBcIi51c2luZy1hcmVhc19fcGFnaW5hdGlvbi1uZXh0XCIsXHJcbiAgICAgIHByZXZFbDogXCIudXNpbmctYXJlYXNfX3BhZ2luYXRpb24tcHJldlwiLFxyXG4gICAgfSxcclxuICAgIGJyZWFrcG9pbnRzOiB7XHJcbiAgICAgIDU1MToge1xyXG4gICAgICAgIHNsaWRlc1BlclZpZXc6IDIsXHJcbiAgICAgICAgc3BhY2VCZXR3ZWVuOiA0MCxcclxuICAgICAgfSxcclxuICAgICAgNzY5OiB7XHJcbiAgICAgICAgc2xpZGVzUGVyVmlldzogMyxcclxuICAgICAgICBzcGFjZUJldHdlZW46IDExLFxyXG4gICAgICB9LFxyXG4gICAgICAxMDI2OiB7XHJcbiAgICAgICAgc2xpZGVzUGVyVmlldzogNCxcclxuICAgICAgfSxcclxuICAgIH0sXHJcbiAgfSk7XHJcblxyXG4gIC8vIEluaXRpYWxpemUgZHJvbmljbyBzbGlkZXJcclxuICBjb25zdCBkcm9uaWNvU2xpZGVyID0gbmV3IFN3aXBlcihcIi5kcm9uaWNvLXNsaWRlcl9fY29udGFpbmVyXCIsIHtcclxuICAgIHNwZWVkOiA1MDAsXHJcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgbG9vcDogdHJ1ZSxcclxuICAgIHNwYWNlQmV0d2VlbjogMTAwLFxyXG4gICAgZWZmZWN0OiBcImZhZGVcIixcclxuICAgIGZhZGVFZmZlY3Q6IHtcclxuICAgICAgY3Jvc3NGYWRlOiB0cnVlLFxyXG4gICAgfSxcclxuICAgIGdyYWJDdXJzb3I6IHRydWUsXHJcbiAgICBuYXZpZ2F0aW9uOiB7XHJcbiAgICAgIG5leHRFbDogXCIuZHJvbmljby1zbGlkZXJfX3BhZ2luYXRpb24tbmV4dFwiLFxyXG4gICAgICBwcmV2RWw6IFwiLmRyb25pY28tc2xpZGVyX19wYWdpbmF0aW9uLXByZXZcIixcclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgY29uc3QgZHJvbmljb0ltZ1NsaWRlciA9IG5ldyBTd2lwZXIoXCIuZHJvbmljby1zbGlkZXJfX2ltZy1jb250YWluZXJcIiwge1xyXG4gICAgc3BlZWQ6IDUwMCxcclxuICAgIHNsaWRlc1BlclZpZXc6IDEsXHJcbiAgICBsb29wOiB0cnVlLFxyXG4gICAgZGlyZWN0aW9uOiBcInZlcnRpY2FsXCIsXHJcbiAgICBzaW11bGF0ZVRvdWNoOiBmYWxzZSxcclxuICAgIG1vdXNld2hlZWxDb250cm9sOiBmYWxzZSxcclxuICAgIGZyZWVNb2RlOiBmYWxzZSxcclxuICB9KTtcclxuICBjb25zdCBkcm9uaWNvSW1nTnVtU2xpZGVyID0gbmV3IFN3aXBlcihcIi5kcm9uaWNvLXNsaWRlcl9faW1nTnVtLWNvbnRhaW5lclwiLCB7XHJcbiAgICBzcGVlZDogNTAwLFxyXG4gICAgc2xpZGVzUGVyVmlldzogMSxcclxuICAgIGxvb3A6IHRydWUsXHJcbiAgICBtb3VzZXdoZWVsQ29udHJvbDogZmFsc2UsXHJcbiAgICBmcmVlTW9kZTogZmFsc2UsXHJcbiAgICBzaW11bGF0ZVRvdWNoOiBmYWxzZSxcclxuICAgIGVmZmVjdDogXCJmYWRlXCIsXHJcbiAgICBmYWRlRWZmZWN0OiB7XHJcbiAgICAgIGNyb3NzRmFkZTogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICBicmVha3BvaW50czoge1xyXG4gICAgICA3Njk6IHtcclxuICAgICAgICBzbGlkZXNQZXJWaWV3OiAxLFxyXG4gICAgICAgIHNwYWNlQmV0d2VlbjogMCxcclxuICAgICAgfSxcclxuICAgICAgMTQ0MToge1xyXG4gICAgICAgIHNwYWNlQmV0d2VlbjogMTAwLFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgZHJvbmljb1NsaWRlci5jb250cm9sbGVyLmNvbnRyb2wgPSBkcm9uaWNvSW1nTnVtU2xpZGVyO1xyXG4gIGRyb25pY29JbWdOdW1TbGlkZXIuY29udHJvbGxlci5jb250cm9sID0gZHJvbmljb0ltZ1NsaWRlcjtcclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSBtb2JpbGUgZHJvbmljbyBzbGlkZXJcclxuICBjb25zdCBkcm9uaWNvTW9iaWxlU2xpZGVyID0gbmV3IFN3aXBlcihcIi5kcm9uaWNvLXNsaWRlcl9fbW9iaWxlLWNvbnRhaW5lclwiLCB7XHJcbiAgICBzcGVlZDogNTAwLFxyXG4gICAgc2xpZGVzUGVyVmlldzogMSxcclxuICAgIGxvb3A6IHRydWUsXHJcbiAgICBtb3VzZXdoZWVsQ29udHJvbDogZmFsc2UsXHJcbiAgICBmcmVlTW9kZTogZmFsc2UsXHJcbiAgICBzaW11bGF0ZVRvdWNoOiBmYWxzZSxcclxuICAgIGVmZmVjdDogXCJmYWRlXCIsXHJcbiAgICBmYWRlRWZmZWN0OiB7XHJcbiAgICAgIGNyb3NzRmFkZTogdHJ1ZSxcclxuICAgIH0sXHJcbiAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgIGVsOiBcIi5kcm9uaWNvLXNsaWRlcl9fbW9iaWxlLXBhZ2luYXRpb25cIixcclxuICAgICAgY2xpY2thYmxlOiB0cnVlLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSB3b3JrIHNsaWRlclxyXG4gIGNvbnN0IHdvcmtTbGlkZXIgPSBuZXcgU3dpcGVyKFwiLndvcmtfX2NvbnRhaW5lclwiLCB7XHJcbiAgICBzcGVlZDogNDAwLFxyXG4gICAgc2xpZGVzUGVyVmlldzogNixcclxuICAgIHNwYWNlQmV0d2VlbjogMjMsXHJcbiAgICBuYXZpZ2F0aW9uOiB7XHJcbiAgICAgIG5leHRFbDogXCIud29ya19fbmF2aWdhdGlvbi1uZXh0XCIsXHJcbiAgICAgIHByZXZFbDogXCIud29ya19fbmF2aWdhdGlvbi1wcmV2XCIsXHJcbiAgICB9LFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCB3b3JrQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSxcclxuICAgIHdvcmtDYXJkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIud29ya19fc2xpZGVcIiksXHJcbiAgICB3b3JrV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud29ya19fd3JhcHBlclwiKTtcclxuXHJcbiAgLy8gY2hlY2sgcmVzaXplIHNsaWRlclxyXG4gIC8vIGZ1bmN0aW9uIGhhbmRsZVRhYmxldENoYW5nZShlKSB7XHJcbiAgLy8gICBpZiAoZS5tYXRjaGVzKSB7XHJcbiAgLy8gICAgIHdvcmtTbGlkZXIuZGVzdHJveShmYWxzZSwgdHJ1ZSk7XHJcblxyXG4gIC8vICAgICB3b3JrQ29udGFpbmVyLmNsYXNzTmFtZSA9IFwid29ya19fY2FyZHNcIjtcclxuICAvLyAgICAgd29ya0NhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcclxuICAvLyAgICAgICB3b3JrQ29udGFpbmVyLmFwcGVuZChjYXJkKTtcclxuICAvLyAgICAgfSk7XHJcbiAgLy8gXHRcdHdvcmtXcmFwcGVyLmFwcGVuZCh3b3JrQ29udGFpbmVyKTtcclxuXHJcbiAgLy8gICB9IGVsc2Uge1xyXG4gIC8vIFx0XHR3b3JrU2xpZGVyLmluaXQoKTtcclxuXHJcbiAgLy8gXHRcdHdvcmtDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgLy8gXHRcdFx0d29ya1dyYXBwZXIuYXBwZW5kKGNhcmQpO1xyXG4gIC8vIFx0XHR9KTtcclxuICAvLyAgIH1cclxuICAvLyB9XHJcbiAgLy8gY29uc3QgbWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogMTI1MXB4KVwiKTtcclxuICAvLyBtZWRpYVF1ZXJ5LmFkZExpc3RlbmVyKGhhbmRsZVRhYmxldENoYW5nZSk7XHJcbiAgLy8gaGFuZGxlVGFibGV0Q2hhbmdlKG1lZGlhUXVlcnkpO1xyXG5cclxuICAvLyBNYWluIGNvZGVcclxuICBjb25zdCBkcm9uc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVjaC1kcm9uaWNvX19pbWctY29udGFpbmVyXCIpLFxyXG4gICAgZHJvbnNCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50ZWNoLWRyb25pY29fX2J0blwiKSxcclxuICAgIGRyb25UZXh0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGVjaC1kcm9uaWNvX190ZXh0XCIpLFxyXG4gICAgYWN0aXZlID0gXCJhY3RpdmUtYnRuXCI7XHJcblxyXG4gIGlmIChkcm9uc0NvbnRhaW5lcikge1xyXG4gICAgZHJvbnNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInRlY2gtZHJvbmljb19fYnRuXCIpKSB7XHJcbiAgICAgICAgZHJvbnNCdG5zLmZvckVhY2goKGJ0bikgPT4ge1xyXG4gICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoYWN0aXZlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBkcm9uVGV4dHMuZm9yRWFjaCgodGV4dCkgPT4ge1xyXG4gICAgICAgICAgdGV4dC5jbGFzc0xpc3QucmVtb3ZlKGFjdGl2ZSk7XHJcbiAgICAgICAgICBpZiAodGV4dC5kYXRhc2V0LnRleHQgPT0gdGFyZ2V0LmRhdGFzZXQudGV4dCkge1xyXG4gICAgICAgICAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoYWN0aXZlKTtcclxuICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoYWN0aXZlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL0xvdHRpZSBzdmcgaGFuZGxlcnNcclxuICBjb25zdCB0ZWNoVGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50ZWNobm9sb2dpZXNfX3RhYnNcIik7XHJcbiAgaWYgKHRlY2hUYWIpIHtcclxuICAgIHRlY2hUYWIub25tb3VzZW92ZXIgPSB0ZWNoVGFiLm9ubW91c2VvdXQgPSAoZSkgPT4ge1xyXG4gICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcclxuICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJ0ZWNobm9sb2dpZXNfX3RhYlwiKSkge1xyXG4gICAgICAgIGNvbnN0IHRlY2hMb3R0aWUgPSB0YXJnZXQucXVlcnlTZWxlY3RvcihcIi5sb3R0aWUtdGVjaFwiKTtcclxuICAgICAgICBpZiAodGVjaExvdHRpZSkge1xyXG4gICAgICAgICAgaWYgKGUudHlwZSA9PSBcIm1vdXNlb3ZlclwiKSB7XHJcbiAgICAgICAgICAgIHRlY2hMb3R0aWUucGxheSgpO1xyXG4gICAgICAgICAgICB0ZWNoTG90dGllLnNldExvb3BpbmcodHJ1ZSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0ZWNoTG90dGllLnNldExvb3BpbmcoZmFsc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXHJcbi8vIFRleHRTY3JhbWJsZVxyXG4vLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcclxuXHJcbmNsYXNzIFRleHRTY3JhbWJsZSB7XHJcbiAgY29uc3RydWN0b3IoZWwpIHtcclxuICAgIHRoaXMuZWwgPSBlbDtcclxuICAgIHRoaXMuY2hhcnMgPSBcIjAxMjM0NTY3ODk+PCstLiVcIjtcclxuICAgIHRoaXMudXBkYXRlID0gdGhpcy51cGRhdGUuYmluZCh0aGlzKTtcclxuICB9XHJcbiAgc2V0VGV4dChuZXdUZXh0KSB7XHJcbiAgICBjb25zdCBvbGRUZXh0ID0gdGhpcy5lbC5pbm5lclRleHQ7XHJcbiAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1heChvbGRUZXh0Lmxlbmd0aCwgbmV3VGV4dC5sZW5ndGgpO1xyXG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiAodGhpcy5yZXNvbHZlID0gcmVzb2x2ZSkpO1xyXG4gICAgdGhpcy5xdWV1ZSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBmcm9tID0gb2xkVGV4dFtpXSB8fCBcIlwiO1xyXG4gICAgICBjb25zdCB0byA9IG5ld1RleHRbaV0gfHwgXCJcIjtcclxuICAgICAgY29uc3Qgc3RhcnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0MCk7XHJcbiAgICAgIGNvbnN0IGVuZCA9IHN0YXJ0ICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNDApO1xyXG4gICAgICB0aGlzLnF1ZXVlLnB1c2goeyBmcm9tLCB0bywgc3RhcnQsIGVuZCB9KTtcclxuICAgIH1cclxuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuZnJhbWVSZXF1ZXN0KTtcclxuICAgIHRoaXMuZnJhbWUgPSAwO1xyXG4gICAgdGhpcy51cGRhdGUoKTtcclxuICAgIHJldHVybiBwcm9taXNlO1xyXG4gIH1cclxuICB1cGRhdGUoKSB7XHJcbiAgICBsZXQgb3V0cHV0ID0gXCJcIjtcclxuICAgIGxldCBjb21wbGV0ZSA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbiA9IHRoaXMucXVldWUubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgIGxldCB7IGZyb20sIHRvLCBzdGFydCwgZW5kLCBjaGFyIH0gPSB0aGlzLnF1ZXVlW2ldO1xyXG4gICAgICBpZiAodGhpcy5mcmFtZSA+PSBlbmQpIHtcclxuICAgICAgICBjb21wbGV0ZSsrO1xyXG4gICAgICAgIG91dHB1dCArPSB0bztcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmZyYW1lID49IHN0YXJ0KSB7XHJcbiAgICAgICAgaWYgKCFjaGFyIHx8IE1hdGgucmFuZG9tKCkgPCAwLjI4KSB7XHJcbiAgICAgICAgICBjaGFyID0gdGhpcy5yYW5kb21DaGFyKCk7XHJcbiAgICAgICAgICB0aGlzLnF1ZXVlW2ldLmNoYXIgPSBjaGFyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvdXRwdXQgKz0gYDxzcGFuIGNsYXNzPVwiZHVkXCI+JHtjaGFyfTwvc3Bhbj5gO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG91dHB1dCArPSBmcm9tO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmVsLmlubmVySFRNTCA9IG91dHB1dDtcclxuICAgIGlmIChjb21wbGV0ZSA9PT0gdGhpcy5xdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5yZXNvbHZlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmZyYW1lUmVxdWVzdCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnVwZGF0ZSk7XHJcbiAgICAgIHRoaXMuZnJhbWUrKztcclxuICAgIH1cclxuICB9XHJcbiAgcmFuZG9tQ2hhcigpIHtcclxuICAgIHJldHVybiB0aGlzLmNoYXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMuY2hhcnMubGVuZ3RoKV07XHJcbiAgfVxyXG59XHJcbmNvbnN0IHBocmFzZXMgPSBbXHJcbiAgXCI3MC41MTIzMjMsIDQ1LjExOTc0XCIsXHJcbiAgXCIyLjM1MTMsIC03OC4yODM5ODY5MFwiLFxyXG4gIFwiNzQuMzIzMzQsIDI0LjM0NTIzXCIsXHJcbiAgXCItMTIuNTEyMzIzLCA0NS4xMTk3NFwiLFxyXG4gIFwiNzIuNTEyMzQ0LCAzLjEyOTA0M1wiLFxyXG4gIFwiLTcwLjUxMjMyMywgMjAuMTE5NzRcIixcclxuICBcIjgzLjEyMzM0MSwgNDIuNzU2NTZcIixcclxuXTtcclxuXHJcbi8vIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zY3J1bWJsZS10ZXh0XCIpO1xyXG5cclxuLy8gY29uc3QgZngxID0gbmV3IFRleHRTY3JhbWJsZShlbFswXSk7XHJcbi8vIGxldCBjb3VudGVyMSA9IDA7XHJcbi8vIGNvbnN0IG5leHQxID0gKCkgPT4ge1xyXG4vLyAgIGZ4MS5zZXRUZXh0KHBocmFzZXNbY291bnRlcjFdKS50aGVuKCgpID0+IHtcclxuLy8gICAgIHNldFRpbWVvdXQobmV4dDEsIDgwMCk7XHJcbi8vICAgfSk7XHJcbi8vICAgY291bnRlcjEgPSAoY291bnRlcjEgKyAxKSAlIHBocmFzZXMubGVuZ3RoO1xyXG4vLyB9O1xyXG4vLyBuZXh0MSgpO1xyXG5cclxuLy8gY29uc3QgZngyID0gbmV3IFRleHRTY3JhbWJsZShlbFsxXSk7XHJcbi8vIGxldCBjb3VudGVyMiA9IDA7XHJcbi8vIGNvbnN0IG5leHQyID0gKCkgPT4ge1xyXG4vLyAgIGZ4Mi5zZXRUZXh0KHBocmFzZXNbY291bnRlcjJdKS50aGVuKCgpID0+IHtcclxuLy8gICAgIHNldFRpbWVvdXQobmV4dDIsIDgwMCk7XHJcbi8vICAgfSk7XHJcbi8vICAgY291bnRlcjIgPSAoY291bnRlcjIgKyAxKSAlIHBocmFzZXMubGVuZ3RoO1xyXG4vLyB9O1xyXG4vLyBuZXh0MigpO1xyXG5cclxuLy8gTW9kYWxcclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWxTZWxlY3Rvcikge1xyXG4gIGNvbnN0IG1vZGFsV2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFNlbGVjdG9yKTtcclxuXHJcbiAgbW9kYWxXaW5kb3cuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsU2VsZWN0b3IsIG1vZGFsVGltZXJJZCkge1xyXG4gIGNvbnN0IG1vZGFsV2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFNlbGVjdG9yKTtcclxuXHJcbiAgbW9kYWxXaW5kb3cuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuICBpZiAobW9kYWxUaW1lcklkKSB7XHJcbiAgICBjbGVhckludGVydmFsKG1vZGFsVGltZXJJZCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBtb2RhbCh0cmlnZ2VyU2VsZWN0b3IsIG1vZGFsU2VsZWN0b3IsIG1vZGFsVGltZXJJZCkge1xyXG4gIGNvbnN0IG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0cmlnZ2VyU2VsZWN0b3IpLFxyXG4gICAgbW9kYWxXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG1vZGFsU2VsZWN0b3IpO1xyXG5cclxuICBtb2RhbEJ0bi5mb3JFYWNoKChidG4pID0+IHtcclxuICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3Blbk1vZGFsKG1vZGFsU2VsZWN0b3IsIG1vZGFsVGltZXJJZCkpO1xyXG4gIH0pO1xyXG5cclxuICBtb2RhbFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgIGlmIChlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNsb3NlXCIpID09IFwiXCIpIHtcclxuICAgICAgY2xvc2VNb2RhbChtb2RhbFNlbGVjdG9yKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbiAgICBpZiAoZS5jb2RlID09PSBcIkVzY2FwZVwiICYmIG1vZGFsV2luZG93LmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKSkge1xyXG4gICAgICBjbG9zZU1vZGFsKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBmdW5jdGlvbiBzaG93TW9kYWxCeVNjcm9sbCgpIHtcclxuICAgIGlmIChcclxuICAgICAgd2luZG93LnBhZ2VZT2Zmc2V0ICsgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA+PVxyXG4gICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0XHJcbiAgICApIHtcclxuICAgICAgb3Blbk1vZGFsKG1vZGFsU2VsZWN0b3IsIG1vZGFsVGltZXJJZCk7XHJcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHNob3dNb2RhbEJ5U2Nyb2xsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHNob3dNb2RhbEJ5U2Nyb2xsKTtcclxufVxyXG5cclxuY29uc3QgbW9kYWxUaW1lcklkID0gc2V0VGltZW91dChcclxuICAoKSA9PiBvcGVuTW9kYWwoXCIuZmVlZGJhY2tcIiwgbW9kYWxUaW1lcklkKSxcclxuICA2MDAwMDBcclxuKTtcclxuXHJcbm1vZGFsKFwiLmJveFwiLCBcIi5mZWVkYmFja1wiLCBtb2RhbFRpbWVySWQpO1xyXG5cclxuLy9GT1JNXHJcbmNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZlZWRiYWNrX19mb3JtXCIpO1xyXG5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZm9ybVNlbmQpO1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gZm9ybVNlbmQoZSkge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgbGV0IGVycm9yID0gZm9ybVZhbGlkYXRlKGZvcm0pO1xyXG5cclxuICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTtcclxuXHJcbiAgaWYgKGVycm9yID09PSAwKSB7XHJcbiAgICBmb3JtLmNsYXNzTGlzdC5hZGQoXCIuX3NlbmRpbmdcIik7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcInBocC9zZW5kbWFpbC5waHBcIiwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBmb3JtRGF0YSxcclxuICAgIH0pO1xyXG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgIGxldCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgIGFsZXJ0KHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgZm9ybS5yZXNldCgpO1xyXG4gICAgICBmb3JtLmNsYXNzTGlzdC5yZW1vdmUoXCJfc2VuZGluZ1wiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGFsZXJ0KFwi0J7RiNC40LHQutCwXCIpO1xyXG4gICAgICBmb3JtLmNsYXNzTGlzdC5yZW1vdmUoXCJfc2VuZGluZ1wiKTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgYWxlcnQoXCLQl9Cw0L/QvtC70L3QuFwiKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZvcm1WYWxpZGF0ZShmb3JtKSB7XHJcbiAgbGV0IGVycm9yID0gMDtcclxuICBjb25zdCBmb3JtUmVxID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5fcmVxXCIpO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcm1SZXEubGVuZ3RoOyBpKyspIHtcclxuICAgIGNvbnN0IGlucHV0ID0gZm9ybVJlcVtpXTtcclxuICAgIGZvcm1SZW1vdmVFcnJvcihpbnB1dCk7XHJcblxyXG4gICAgaWYgKGlucHV0LmNsYXNzTGlzdC5jb250YWlucyhcIl9uYW1lXCIpKSB7XHJcbiAgICAgIGlmICghL15cXHd7NCwyMH0kL2dpLnRlc3QoaW5wdXQudmFsdWUpKSB7XHJcbiAgICAgICAgZm9ybUFkZEVycm9yKGlucHV0KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoXCJfcGhvbmVcIikpIHtcclxuICAgICAgaWYgKCEvXlxcZHs0LDEyfSQvZy50ZXN0KGlucHV0LnZhbHVlKSkge1xyXG4gICAgICAgIGZvcm1BZGRFcnJvcihpbnB1dCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgIGlucHV0LmdldEF0dHJpYnV0ZShcInR5cGVcIikgPT09IFwiY2hlY2tib3hcIiAmJlxyXG4gICAgICBpbnB1dC5jaGVja2VkID09PSBmYWxzZVxyXG4gICAgKSB7XHJcbiAgICAgIGZvcm1BZGRFcnJvcihpbnB1dCk7XHJcbiAgICAgIGVycm9yKys7XHJcbiAgICB9IGVsc2UgaWYgKGlucHV0LnZhbHVlID09PSBcIlwiKSB7XHJcbiAgICAgIGZvcm1BZGRFcnJvcihpbnB1dCk7XHJcbiAgICAgIGVycm9yKys7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiBlcnJvcjtcclxufVxyXG5cclxuZnVuY3Rpb24gZm9ybUFkZEVycm9yKGlucHV0KSB7XHJcbiAgaW5wdXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiX2Vycm9yXCIpO1xyXG4gIGlucHV0LmNsYXNzTGlzdC5hZGQoXCJfZXJyb3JcIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZvcm1SZW1vdmVFcnJvcihpbnB1dCkge1xyXG4gIGlucHV0LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIl9lcnJvclwiKTtcclxuICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKFwiX2Vycm9yXCIpO1xyXG59XHJcbiJdLCJmaWxlIjoibWFpbi5taW4uanMifQ==
